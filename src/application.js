import { pipe, scan, map, forEach } from "callbag-basics";
import { interpolate } from "flubber";
import { interpolate as interpolateColor } from "./colorInterpolator";
import { raf } from "./callbag-raf";

const from = "m 366.95714,480.26305 c 0,0 -16.25386,-8.60498 -43.98102,-8.60498 -27.72717,0 -46.84935,1.91222 -46.84935,1.91222 l 51.62989,-37.28826 c 0,0 -16.25385,-13.38553 -50.67378,-16.25385 -34.41993,-2.86833 -66.92764,3.82443 -66.92764,3.82443 0,0 21.99051,-42.0688 42.0688,-58.32266 20.07829,-16.25385 65.97153,-16.25385 65.97153,-16.25385 0,0 -17.20996,-43.98102 -41.11269,-61.19098 -23.90273,-17.20997 -56.41044,-45.89324 -56.41044,-45.89324 0,0 80.31317,-22.94662 114.73309,-11.47331 34.41993,11.47331 74.57652,43.98102 74.57652,43.98102 0,0 8.60498,-48.76157 0,-80.31317 -8.60499,-31.5516 -22.94662,-60.23487 -22.94662,-60.23487 0,0 97.52313,18.16607 112.82088,60.23487 15.29774,42.0688 23.90272,88.91815 23.90272,88.91815 0,0 26.77106,5.73665 36.33215,17.20996 9.56109,11.47331 23.90273,31.55161 23.90273,31.55161 0,0 47.79468,-16.82935 67.06271,-20.54774 19.26803,-3.7184 62.87462,-4.7325 62.87462,-4.7325 l -75.0439,62.19855 c 0,0 36.84588,-0.67607 54.76177,0 17.91588,0.67607 46.98695,7.43679 46.98695,7.43679 l -95.66408,46.64891 47.32498,16.56375 c 0,0 -40.22624,2.70428 -58.48016,8.45089 -18.25392,5.7466 -49.01517,24.33856 -49.01517,24.33856 0,0 7.09875,-22.31035 5.07054,-31.77535 -2.02821,-9.46499 -2.36625,-26.02874 -10.14107,-18.92999 -7.77482,7.09875 -6.08464,20.28214 -21.97232,29.4091 -15.88767,9.12696 -15.88767,9.12696 -15.88767,9.12696 l 7.77482,-26.70481 -13.85946,14.19749 c 0,0 2.02821,-12.50732 1.69018,-20.95821 -0.33804,-8.45089 -0.33804,-10.81714 -0.33804,-10.81714 0,0 -3.04232,13.52143 -19.60606,26.36678 -16.56375,12.84536 -27.04286,22.31035 -27.04286,22.31035 0,0 17.91589,-46.64891 10.47911,-68.95926 -7.43678,-22.31036 -18.25392,-30.42321 -18.25392,-30.42321 0,0 -10.14107,-0.33804 -30.08518,27.71892 -19.9441,28.05696 -31.77534,38.8741 -36.16981,54.76177 -4.39446,15.88768 -7.77482,25.35267 -7.77482,25.35267 0,0 -8.78892,-27.38088 -12.16928,-40.56427 -3.38036,-13.18339 -6.08464,-24.6766 -6.08464,-24.6766 l -15.2116,28.73303 c 0,0 2.70428,11.15517 6.08464,16.56374 3.38035,5.40857 7.77482,15.54964 7.77482,15.54964 0,0 -16.56375,-8.11285 -24.33857,-21.29624 -7.77482,-13.18339 -11.49321,-24.00053 -11.49321,-24.00053 0,0 -7.77482,-6.42268 -3.38036,18.25392 4.39447,24.6766 17.09027,38.60094 17.09027,38.60094 z";
const to = "m 378.61922,503.95611 -70.27402,-28.20522 35.85409,-4.78055 c 0,0 -39.20048,-12.42942 -58.80071,-39.67853 -19.60024,-27.24911 -43.02491,-57.8446 -43.02491,-57.8446 l 53.06405,17.20997 c 0,0 -10.99525,-31.07355 -15.7758,-45.89324 -4.78054,-14.81969 -26.293,-98.9573 -26.293,-98.9573 l 45.89324,32.02966 c 0,0 -5.2586,-34.89799 -3.34638,-76.96679 1.91222,-42.0688 7.64887,-65.49347 7.64887,-65.49347 l 31.07355,63.1032 24.38078,-72.18624 c 0,0 0,-10.99526 8.60498,-26.293002 8.60498,-15.297746 73.62041,-66.449585 73.62041,-66.449585 l -10.99526,87.962037 c 0,0 17.20997,-20.07829 26.293,-48.761562 9.08304,-28.683274 12.90748,-56.888494 12.90748,-56.888494 0,0 63.1032,52.107948 72.18624,69.317913 9.08303,17.209963 13.86358,37.288253 13.86358,37.288253 l 15.29774,-34.419926 c 0,0 27.72717,53.064056 31.55161,67.883746 3.82443,14.81969 5.73665,24.38079 5.73665,24.38079 l 19.60024,-35.37604 c 0,0 8.60498,93.22064 6.69276,108.04033 -1.91222,14.81969 -5.2586,33.94187 -5.2586,33.94187 l 45.89324,-36.8102 c 0,0 -23.90273,112.34283 -30.11744,121.42586 -6.21471,9.08304 -10.99525,14.81969 -10.99525,14.81969 l 54.49822,-15.7758 c 0,0 -55.93239,78.40095 -67.88375,87.96204 -11.95137,9.5611 -28.68328,15.7758 -28.68328,15.7758 l 32.98577,3.34639 -59.75682,17.68802 c 0,0 1.43416,-2.39028 11.95136,-12.42942 10.5172,-10.03915 23.42468,-51.15184 15.29775,-58.80071 -8.12693,-7.64888 -10.5172,-2.39028 -10.5172,-2.39028 0,0 0.47805,4.06347 -0.95611,6.21471 -1.43416,2.15125 -44.45907,48.04449 -44.45907,48.04449 0,0 16.25385,-34.89799 16.25385,-49.23963 0,-14.34163 -10.75623,-20.31731 -10.75623,-20.31731 0,0 -10.5172,22.70759 -21.99051,37.52728 -11.47331,14.81969 -31.79063,32.02966 -31.79063,32.02966 0,0 21.99051,-36.81021 22.7076,-54.97628 0.71708,-18.16607 -1.19514,-37.28826 -1.19514,-37.28826 0,0 -4.78055,1.19514 -9.80012,6.93179 -5.01957,5.73666 -6.93179,8.60499 -6.93179,8.60499 0,0 -7.40985,-16.73191 -14.81969,-16.73191 -7.40985,0 -41.1127,2.6293 -51.86892,35.37604 -10.75623,32.74673 -9.08304,78.63997 -9.08304,78.63997 0,0 -20.31732,-46.13226 -18.88316,-69.07888 1.43417,-22.94662 0.47806,-19.83927 0.47806,-19.83927 0,0 -10.27817,10.03915 -13.38553,28.44425 -3.10735,18.4051 0.95611,38.24436 0.95611,38.24436 l -32.26868,-48.28351 c 0,0 -1.91222,-0.71708 -4.06347,4.78055 -2.15124,5.49763 -3.10735,32.74674 2.15125,41.59075 5.2586,8.84401 30.35646,29.87841 30.35646,29.87841 z"

const destination = main.querySelector("path");
const interpolator = interpolate(from, to);

pipe(
  raf,
  scan(frame => frame + 1, 0),
  map(frame => {
    const step =  Math.abs(Math.sin(frame / 100));
    return {
      path: interpolator(step),
      color: interpolateColor("000000", "05bbcb", step)
    };
  }),
  forEach(stepDef => {
    destination.setAttribute("d", stepDef.path);
    destination.style.fill = stepDef.color;
  })
)

